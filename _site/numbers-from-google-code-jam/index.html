
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Numbers From Google Code Jam</title>
    
    <meta name="author" content="He Yi">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.2.2.2.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

    <script type="text/javascript"
        src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>

  </head>

  <body>
    <div class="navbar">
      <div class="navbar-inner">
        <div class="container-narrow">
          <a class="brand" href="/">while(2) {</a>
          <ul class="nav">
            
            
            


  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
  
    
      
      	
      	<li><a href="/pages.html">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container-narrow">

      <div class="content">
        
<div class="page-header">
  <h1>Numbers From Google Code Jam </h1>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="date">
      <span>09 August 2014</span>
    </div>
    <div class="content">
      <p>A very funny problem from <a href="https://code.google.com/codejam/contest/32016/dashboard#s=p2">Google Code Jam</a>.</p>

<p>Briefly:</p>

<blockquote>
  <p>Find the last three digits before the decimal point for the number <script type="math/tex"> (3 + \sqrt{5})^n </script>.</p>
</blockquote>

<p>This remind me of the closed form formula of <a href="http://en.wikipedia.org/wiki/Fibonacci_number#Closed-form_expression" title="Fibonacci Series">Fibonacci series</a>, if you don’t have patients, jump to <a href="#induction-proof">Proof</a>.</p>

<h3 id="start-from-fibonacci">Start from Fibonacci</h3>

<p>The closed form formula:</p>

<script type="math/tex; mode=display">
F_n= {1\over \sqrt5}({1+\sqrt5 \over 2})^n-
{1\over \sqrt5}({1-\sqrt5 \over 2})^n
</script>

<p>It is interesting to have an irrational expression derived to an integral result. The trick is that there are two parts aside the subtraction, both of which have irrational components, but cancel with each other. </p>

<p>Moreover, the two parts are not equally important, the first one is the main part, while the second one is always less than 1 because <script type="math/tex"> 1-\sqrt5 \over 2 </script> is. For the nth Fibonacci number, the first part already have a very good guess. The second one is a residual to pull the values from irrational to an integer, the accurate one.</p>

<p>Inspired by this, I claim that</p>

<script type="math/tex; mode=display">
A_n = (a+b\sqrt c)^n + (a-b\sqrt c)^n
</script>

<p>must always be an integer, with a,b,c integers. It’s easy to prove that via induction, or you can think of this as a complex number with a <script type="math/tex">\sqrt5</script> took the place of <script type="math/tex">i</script>.</p>

<h3 id="induction-proof">Induction Proof</h3>
<p>If we represent:</p>

<script type="math/tex; mode=display">
B_n = (a+b\sqrt c)^n=a_n+b_n\sqrt c,\\
C_n = (a-b\sqrt c)^n=a_n-b_n\sqrt c,\\
a_1 = a, b_1 = b
</script>

<p>then we have:</p>

<script type="math/tex; mode=display">
A_n = B_n + C_n = 2a_n
</script>

<p>is an integer. 
So we are to prove that the <script type="math/tex">a_n,b_n</script> representation exists.
This is obvious when <script type="math/tex">n=1</script>, assume this holds for <script type="math/tex">n-1</script>, then</p>

<script type="math/tex; mode=display">
B_n = B_ {n-1} B_1 = 
(a_ {n-1}+b_ {n-1} \sqrt c)(a_1+b_1 \sqrt c) \\
=(a_1 a_ {n-1} + b_1 b_ {n-1}c) +
 (a_1 b_ {n-1} + b_1 a_ {n-1})\sqrt c \\
C_n = C_ {n-1} C_1 = 
(a_ {n-1}-b_ {n-1} \sqrt c)(a_1-b_1 \sqrt c) \\
=(a_1 a_ {n-1} + b_1 b_ {n-1}c) -
 (a_1 b_ {n-1} + b_1 a_ {n-1})\sqrt c
</script>

<p>also holds for <script type="math/tex">n</script>. </p>

<p>And we have the transformation:</p>

<script type="math/tex; mode=display">
a_n = a_1 a_ {n-1} + b_1 b_ {n-1}c \\
b_n = a_1 b_ {n-1} + b_1 a_ {n-1}
</script>

<p>Now it’s easy to solve <script type="math/tex">A_n</script> through <script type="math/tex">a_n, b_n</script>.</p>

<p>Put in <script type="math/tex"> a = 3, b = 1</script>, we know that the second part  <script type="math/tex">(3-\sqrt5)^n</script> is always less than 1, it makes up to 1 with a minor part from <script type="math/tex">(3+\sqrt5)^n</script>. Thus the integral part of <script type="math/tex">(3+\sqrt5)^n</script> is exactly 1 less than <script type="math/tex">A_n</script>.</p>

<h3 id="code">Code</h3>
<p>The code is simple compare to the deducing:</p>

<pre><code class="language-cpp">#include &lt;stdio.h&gt;

int main() {
	int T; scanf("%d", &amp;T);
	for (int t = 1; t &lt;= T; ++t) {
		int n; scanf("%d", &amp;n);
		int a = 1, b = 0;
		for (unsigned bit_flat = 1 &lt;&lt; 31; bit_flat &gt; 0; bit_flat &gt;&gt;= 1) {
			// A_n = (A_{n/2})^2
			int a2 = a*a + 5*b*b;
			int b2 = 2*a*b;
			a = a2 % 1000, b = b2 % 1000;

			if (bit_flat &amp; n) {
				// A_n = A_{n-1} * (3 + \sqrt 5)
				int a2 = 3*a + 5*b;
				int b2 = a + 3*b;
				a = a2 % 1000, b = b2 % 1000;
			}
		}

		printf("Case #%d: %03d\n", t, (2*a-1)%1000);
	}
	return 0;
}
</code></pre>


    </div>

    

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
     
    	<li><a href="/tags.html#code-ref">code <span>7</span></a></li>
     
    	<li><a href="/tags.html#math-ref">math <span>4</span></a></li>
    
  



    </ul>
    

    <hr>
    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="/abstraction-of-2d-filter" title="Abstraction of 2d Filter">&larr; Previous</a></li>
      
        <li><a href="/archive.html">Archive</a></li>
      
        <li class="next disabled"><a>Next &rarr;</a>
      
      </ul>
    </div>
    <hr>
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'while2'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




  </div>
</div>


      </div>
      <hr>
      <footer>
        <p>&copy; 2014 He Yi
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>

    </div>

    
  </body>
</html>

